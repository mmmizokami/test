config {
  type: "incremental",
  tags: ["samsung"],
  bigquery: {
    partitionBy: "EventDate"
  }  
  ,schema: "samsung_dataform"
}



/*
pre_operations {

DELETE
FROM `uolcs-caribe-qa.samsung_dataform.ad_impressions`
WHERE EventDate BETWEEN (CAST("${dataform.projectConfig.vars.date}" AS DATE))
              AND (CAST("${dataform.projectConfig.vars.date}" AS DATE)-1)

}
*/
WITH variables as (
  SELECT
    CAST("${dataform.projectConfig.vars.date}" AS DATE) as start_date,
    CAST("${dataform.projectConfig.vars.date}" AS DATE)-1 as end_date
)
SELECT
  EventDate,
  KeyPart,
  TimeUsec2,
  uolid,
  DeviceCategory,
  AdvertiserId,
  AdUnitId,
  OrderId,
  LineItemId,
  DealId,
  ImpressionId,
  Domain,
  RefererURL,
  Clicks,
  ViewableImpression,
  MeasurableImpression
FROM `uolcs-caribe-qa.samsung.sample_external_network` n 
WHERE
  n.EventDate >= (SELECT start_date FROM variables)
  AND n.EventDate <= (SELECT end_date FROM variables)
  AND n.Source = 0
  AND n.LineItemId in (
    5623769439, 5625390419, 5625390422, 5625390641, 5630013337, 5640387510, 5640394542, 5641258771, 5641439716, 5641441363, 5641986920, 5660703742, 5661418265, 5661418268, 5666020057, 5666750837, 5677793404, 5681769766, 5681769772, 5690842443, 5692489838, 5704603154, 5704603154, 5705064683, 5705064695, 5706957532, 5707504022, 5711487519, 5711569563, 5712673834, 5722041982, 5722687841, 5727642158, 5729615693, 5732710273, 5741763060, 5741769573, 5774522808, 5775867043, 5776884904, 5776885888, 5777409110, 5777409110, 5777409110, 5777409110, 5783346454, 5783417017, 5783940659, 5794109910, 5795481751, 5795482258, 5796089024, 5801090580, 5801137827, 5801137830, 5802375049, 5802404605, 5803150769, 5803151438, 5803151441, 5803152467, 5805681993, 5806903381, 5807602295, 5811767418, 5827838571, 5828986285, 5829205155, 5829206805, 5829211593, 5829653753, 5830356439, 5831033513, 5831034947, 5831039456, 5831040893, 5831660622, 5853539907, 5854853917, 5856316452, 5856316458, 5857579672, 5858319829, 5858609401, 5865319802, 5865331646, 5889384369, 5889387567, 5889387573, 5890693606, 5890698883, 5891186819, 5891282141, 5891292398, 5917136799, 5918319783, 5918327019, 5918331528, 5918345190, 5918345190, 5918619254, 5918619257, 5918619260, 5918619263, 5918619761, 5918619764, 5918619767, 5918619770, 5918619773, 5918619776, 5918971595, 5919494836, 5919502015, 5919504226, 5919533992, 5920133696, 5920139723, 5920141094, 5920165883, 5920170944, 5924925109, 5924925109, 5924925538, 5924927494, 5924927494, 5924927953, 5940548875, 5940549805, 5946436760, 5950831388, 5958029442, 5960207420, 5965101549, 5967106721, 5967949111, 5968786737, 5970040029, 5970487364, 5970816875, 5974557313, 5975232392, 5975235488, 5983253648, 5988017241, 5988017898, 5989338433, 5989342945, 5990000561, 5995260135, 5995260141, 5998871905, 6002593800, 6002593803, 6002593806, 6002715765, 6002717508, 6004078042, 6004081339, 6004678274, 6004681649, 6012920601, 6013769016, 6026348825, 6033620583, 6033620586, 6034573825, 6034573825, 6040176128, 6055114009, 6057784227, 6059434319, 6059435204, 6059439011, 6065158493, 6065158496, 6079558960, 6089503160, 6090333738, 6090333741, 6090333744, 6092040207, 6092058363, 6093477979, 6094178081, 6089801721, 6091205737, 6091213363, 6091222507, 6100892311, 6100892314, 6101576571, 6101677874, 6102936628, 6102937819, 6103783589, 6103803347, 6104503105, 6104503108, 6104503435
  )
